import { Image } from "mdx-deck";
import {
  CodeSurfer,
  CodeSurferColumns,
  Step,
} from "code-surfer";
import {
  vsDark,
  github,
  nightOwl,
} from "@code-surfer/themes";
import Author from "./slides/Author";
import TableOfContents from "./slides/TableOfContents";

export const theme = nightOwl;

# Painless Development with GraphQL

---

<Author />

---

<TableOfContents activeStep={0} />

---

# We had SSR

<small>
  <em>Reload page on every request</em>
</small>

<Image
  src="https://sitedown.co/sites/default/files/styles/800px/public/reports/Screen%20shot%202013-11-14%20at%2010.23.34%20PM.png?itok=Yfkg1ag6"
  size={800}
/>

---

# Along came XHR

# üòë

---

<CodeSurfer>

```js title="Who remembers this?"
// Configure
var xhr = new XMLHttpRequest();
xhr.open("POST", "/server", true);
xhr.setRequestHeader(
  "Content-Type",
  "application/x-www-form-urlencoded"
);

// Callback
xhr.onreadystatechange = function() {
  if (this.readyState === 4 && this.status === 200) {
    // Request finished. Do processing here.
  }
};

// Send
xhr.send("page=2&pageSize=10");
```

```js 1:7 title="Who remembers this?"
// Configure
var xhr = new XMLHttpRequest();
xhr.open("POST", "/server", true);
xhr.setRequestHeader(
  "Content-Type",
  "application/x-www-form-urlencoded"
);

// Callback
xhr.onreadystatechange = function() {
  if (this.readyState === 4 && this.status === 200) {
    // Request finished. Do processing here.
  }
};

// Send
xhr.send("page=2&pageSize=10");
```

```js 8:15 title="Who remembers this?"
// Configure
var xhr = new XMLHttpRequest();
xhr.open("POST", "/server", true);
xhr.setRequestHeader(
  "Content-Type",
  "application/x-www-form-urlencoded"
);

// Callback
xhr.onreadystatechange = function() {
  if (this.readyState === 4 && this.status === 200) {
    // Request finished. Do processing here.
  }
};

// Send
xhr.send("page=2&pageSize=10");
```

```js 15:17 title="Who remembers this?"
// Configure
var xhr = new XMLHttpRequest();
xhr.open("POST", "/server", true);
xhr.setRequestHeader(
  "Content-Type",
  "application/x-www-form-urlencoded"
);

// Callback
xhr.onreadystatechange = function() {
  if (this.readyState === 4 && this.status === 200) {
    // Request finished. Do processing here.
  }
};

// Send
xhr.send("page=2&pageSize=10");
```

</CodeSurfer>

---

# jQuery to the rescue

# ü§Ø

---

<CodeSurfer>

```js title="How about this?"
$.ajax({
  url: "/profile",
  type: "GET",
  data: "id=5",
  success: function(data) {
    // Handle success
    $("#ajax-results").html(data);
  },
  error: function(e) {
    // Handle error
  },
});
```

</CodeSurfer>

---

<CodeSurfer>

```js title="But then we got this"
$("#item").css("color", "#123456");
$("#item").html("hello");
$("#item").css("background-color", "#ffffff");

// you could use this instead
$("#item")
  .css("color", "#123456")
  .html("hello")
  .css("background-color", "#ffffff");

// or even
var item = $("#item");
item.css("color", "#123456");
item.html("hello");
item.css("background-color", "#ffffff");

// as for loops, this is a big no-no
console.time("no cache");
for (var i = 0; i < 1000; i++) {
  $("#list").append(i);
}
console.timeEnd("no cache");

// much better this way
console.time("cache");
var item = $("#list");

for (var i = 0; i < 1000; i++) {
  item.append(i);
}
console.timeEnd("cache");
```

</CodeSurfer>

---

# Save us Angular!

ü•∫

---

<CodeSurfer>

```js title="It was amazing" subtitle="Organized code, template binding, routing, and services!"
app.controller("Ctrl", function($scope) {
  this.name = "name";

  $scope.$watch(
    angular.bind(function() {
      return this.title;
    }),
    function(newVal, oldVal) {}
  );
});
```

</CodeSurfer>

---

<CodeSurfer>

```js title="rootScope is evil" subtitle="Two-way binding is crazy"
var myObject = {
  status: 10,
};

$rootScope.$broadcast("status_updated", myObject);

$rootScope.$on("status_updated", function(event, obj) {
  console.log(obj.status); // 10
});
```

</CodeSurfer>

---

# #react

<iframe
  src="https://giphy.com/embed/l0NwKAlZzZ9pyi9fa"
  width="500"
  height="400"
  frameBorder="0"
  class="giphy-embed"
  allowFullScreen
/>

---

<CodeSurfer>

```jsx title="Mind. ¬†Blown. ¬†Again. ¬†  ü§Ø"
class Username extends React.Component {
  render() {
    const { firstName, lastName } = this.props;
    return (
      <h1>
        {firstName} {lastName}
      </h1>
    );
  }
}
```

</CodeSurfer>

---

<CodeSurferColumns>

<Step>

```js title="Component"
class Profile extends React.Component {
  componentDidMount() {
    this.props.fetchProfile();
  }

  render() {
    // return JSX
  }
}

// Select data from Redux
const mapStateToProps = state => ({
  profile: state.profile,
});

// Connect Action Creators to Redux
const mapDispatchToProps = {
  fetchProfile,
};

// Connect to Redux
const ConnectedProfile = connect(
  mapStateToProps,
  mapDispatchToProps
)(Profile);

export default ConnectedProfile;
```

```js title="Actions"
// Redux Action Creators
const fetchProfileRequest = () => ({
  type: "FETCH_PROFILE_REQUEST",
  payload: {},
});

const fetchProfileSuccess = ({ profile }) => ({
  type: "FETCH_PROFILE_SUCCESS",
  payload: { profile },
});

const fetchProfileFailure = ({ error }) => ({
  type: "FETCH_PROFILE_ERROR",
  payload: { error },
});

// Redux Action
export const fetchProfile = ({ id }) => async dispatch => {
  dispatch(fetchProfileRequest());
  try {
    const profile = await profileUtils.getProfile({ id });
    fetchProfileSuccess({ profile });
  } catch (error) {
    fetchProfileFailure({ error });
  }
};
```

```js title="Reducer"
// Initial state
const initialState = {
  error: null,
  loading: false,
  profile: null,
};

export default reducer = (state = initialState, action) => {
  const { type, payload } = action;

  switch (type) {
    case "FETCH_PROFILE_REQUEST":
      return {
        ...state,
        error: null,
        loading: true,
        profile: null,
      };
    case "FETCH_PROFILE_SUCCESS":
      return {
        ...state,
        error: false,
        loading: false,
        profile: payload.profile,
      };
    case "FETCH_PROFILE_FAILURE":
      return {
        ...state,
        error: payload.error,
        loading: false,
        profile: null,
      };
    default:
      return state;
  }
};
```

</Step>

<Step>

```js 12:26 title="Component" subtitle="Connect to Redux"
// Component
class Profile extends React.Component {
  componentDidMount() {
    this.props.fetchProfile();
  }

  render() {
    // return JSX
  }
}

// Select data from Redux
const mapStateToProps = state => ({
  profile: state.profile,
});

// Connect Action Creators to Redux
const mapDispatchToProps = {
  fetchProfile,
};

// Connect to Redux
const ConnectedProfile = connect(
  mapStateToProps,
  mapDispatchToProps
)(Profile);

export default ConnectedProfile;
```

```js 15:26 title="Actions" subtitle="Higher-order async function via redux-thunk"
// Redux Action Creators
const fetchProfileRequest = () => ({
  type: "FETCH_PROFILE_REQUEST",
  payload: {},
});

const fetchProfileSuccess = ({ profile }) => ({
  type: "FETCH_PROFILE_SUCCESS",
  payload: { profile },
});

const fetchProfileFailure = ({ error }) => ({
  type: "FETCH_PROFILE_ERROR",
  payload: { error },
});

// Redux Action
export const fetchProfile = ({ id }) => async dispatch => {
  dispatch(fetchProfileRequest());
  try {
    const profile = await profileUtils.getProfile({ id });
    fetchProfileSuccess({ profile });
  } catch (error) {
    fetchProfileFailure({ error });
  }
};
```

```js 6:36 title="Reducer" subtitle="Handle state updates from dispatched events"
// Initial state
const initialState = {
  error: null,
  loading: false,
  profile: null,
};

export default reducer = (state = initialState, action) => {
  const { type, payload } = action;

  switch (type) {
    case "FETCH_PROFILE_REQUEST":
      return {
        ...state,
        error: null,
        loading: true,
        profile: null,
      };
    case "FETCH_PROFILE_SUCCESS":
      return {
        ...state,
        error: false,
        loading: false,
        profile: payload.profile,
      };
    case "FETCH_PROFILE_FAILURE":
      return {
        ...state,
        error: payload.error,
        loading: false,
        profile: null,
      };
    default:
      return state;
  }
};
```

</Step>

</CodeSurferColumns>

---

You can ease the pain with utils, but still...

## WOOF üê∂

---

We're just making an API request, it doesn't have to be this hard
